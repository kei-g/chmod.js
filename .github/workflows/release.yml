jobs:
  release:
    if: github.ref_type == 'tag'
    name: Create Release
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 1
      - id: commit_summary
        name: Get commit summary
        run: |
          ref="${{ github.ref }}"
          git fetch --depth 1 origin +$ref:$ref
          msg="$(git for-each-ref --format='%(contents)' $ref | sed '/^Signed-off-by: /,//d')"
          msg="${msg//'%'/'%25'}"
          msg="${msg//$'\n'/'%0A'}"
          msg="${msg//$'\r'/'%0D'}"
          echo "::set-output name=message::$msg"
          echo "::set-output name=version::${ref:11}"
      - env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        name: Create release
        uses: actions/create-release@v1
        with:
          body: |
            ${{ steps.commit_summary.outputs.message }}
          draft: false
          prerelease: false
          release_name: Version ${{ steps.commit_summary.outputs.version }}
          tag_name: v${{ steps.commit_summary.outputs.version }}
name: Create Release
on:
  create:
    tags:
      - 'v[0-9]+(\.[0-9]+)*(\-[0-9A-Za-z]+)*'
